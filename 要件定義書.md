# ãƒ†ãƒ¬ã‚¢ãƒæ–‡å­—èµ·ã“ã—ã‚·ã‚¹ãƒ†ãƒ  MVPåˆå›è¦ä»¶å®šç¾©æ›¸

## **MVPæ¦‚è¦**

æœ€å°é™ã®æ©Ÿèƒ½ã§å‹•ä½œã™ã‚‹æ–‡å­—èµ·ã“ã—ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚1ã¤ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€Whisper APIã§æ–‡å­—èµ·ã“ã—ã‚’è¡Œã„ã€Google Sheetsã«çµæœã‚’å‡ºåŠ›ã™ã‚‹åŸºæœ¬æ©Ÿèƒ½ã®ã¿ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

## **MVPæ©Ÿèƒ½è¦ä»¶**

**å¿…é ˆæ©Ÿèƒ½ã®ã¿ï¼š**

**å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ï¼š**
mp3ãƒ•ã‚¡ã‚¤ãƒ«1ã¤ã‚’Streamlitã®file_uploaderã§ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹æ©Ÿèƒ½ã€‚ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯ï¼ˆmp3ã®ã¿ï¼‰ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºåˆ¶é™ï¼ˆ25MBä»¥ä¸‹ï¼‰ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

**æ–‡å­—èµ·ã“ã—æ©Ÿèƒ½ï¼š**
OpenAI Whisper APIã‚’ä½¿ç”¨ã—ã¦ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚å‡¦ç†ä¸­ã¯ã€Œå‡¦ç†ä¸­...ã€ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã€å®Œäº†å¾Œã«çµæœã‚’ç”»é¢ã«è¡¨ç¤ºã—ã¾ã™ã€‚

**Google Sheetså‡ºåŠ›æ©Ÿèƒ½ï¼š**
æ–‡å­—èµ·ã“ã—çµæœã‚’ã€Œãƒ†ãƒ¬ã‚¢ãƒãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆã€ã®ã€ŒDifyãƒ†ã‚¹ãƒˆã€ã‚·ãƒ¼ãƒˆã®Aåˆ—ã«è¿½è¨˜ã—ã€Båˆ—ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

**åŸºæœ¬ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºï¼š**
ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚¨ãƒ©ãƒ¼ã€APIã‚¨ãƒ©ãƒ¼ã€æ¥ç¶šã‚¨ãƒ©ãƒ¼ã®åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’Streamlitä¸Šã«è¡¨ç¤ºã—ã¾ã™ã€‚

## **MVPæŠ€è¡“ä»•æ§˜**

**ä½¿ç”¨æŠ€è¡“ï¼š**
- **Python**: 3.11+
- **Streamlit**: 1.28.0+
- **OpenAI**: 1.3.0+
- **gspread**: 5.12.0+
- **google-auth**: 2.23.0+

**ç°¡ç•¥åŒ–ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ï¼š**
```
teleapo_mvp/
â”œâ”€â”€ app.py                 # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ requirements.txt       # ä¾å­˜é–¢ä¿‚
â”œâ”€â”€ credentials.json       # Google Sheetsèªè¨¼æƒ…å ±
â”œâ”€â”€ .env                   # APIã‚­ãƒ¼
â””â”€â”€ README.md
```

**ç’°å¢ƒå¤‰æ•°ï¼ˆ.envï¼‰ï¼š**
```
OPENAI_API_KEY=your_openai_api_key_here
```

## **MVPå®Ÿè£…ç¯„å›²å¤–ï¼ˆå°†æ¥æ‹¡å¼µï¼‰**

- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ä¸€æ‹¬å‡¦ç†
- å‡¦ç†é€²æ—ãƒãƒ¼
- é‡è¤‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
- è©³ç´°ãƒ­ã‚°æ©Ÿèƒ½
- ãƒ•ã‚¡ã‚¤ãƒ«è‡ªå‹•å‰Šé™¤
- ã‚¨ãƒ©ãƒ¼ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½

## **å…·ä½“çš„ãªé–‹ç™ºã‚¹ãƒ†ãƒƒãƒ—**

**ã‚¹ãƒ†ãƒƒãƒ—1: ç’°å¢ƒæ§‹ç¯‰ï¼ˆ1æ™‚é–“ï¼‰**
1. æ–°ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `teleapo_mvp` ã‚’ä½œæˆ
2. ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆãƒ»æ´»æ€§åŒ–
3. `requirements.txt` ã‚’ä½œæˆã—ã€å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
4. `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€OpenAI APIã‚­ãƒ¼ã‚’è¨­å®š

**ã‚¹ãƒ†ãƒƒãƒ—2: Google Sheetsèªè¨¼è¨­å®šï¼ˆ30åˆ†ï¼‰**
1. Google Cloud Consoleã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. Sheets API ã¨ Drive API ã‚’æœ‰åŠ¹åŒ–
3. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã¨ `credentials.json` ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
4. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…±æœ‰è¨­å®š

**ã‚¹ãƒ†ãƒƒãƒ—3: åŸºæœ¬Streamlitã‚¢ãƒ—ãƒªä½œæˆï¼ˆ30åˆ†ï¼‰**
```python
import streamlit as st

st.title("ãƒ†ãƒ¬ã‚¢ãƒæ–‡å­—èµ·ã“ã—MVP")

uploaded_file = st.file_uploader(
    "mp3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", 
    type=['mp3']
)

if uploaded_file is not None:
    st.write(f"ãƒ•ã‚¡ã‚¤ãƒ«å: {uploaded_file.name}")
    st.write(f"ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: {uploaded_file.size} bytes")
```

**ã‚¹ãƒ†ãƒƒãƒ—4: Whisper APIé€£æºå®Ÿè£…ï¼ˆ1æ™‚é–“ï¼‰**
1. OpenAI ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–
2. éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Whisper APIã«é€ä¿¡ã™ã‚‹é–¢æ•°ä½œæˆ
3. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‡¦ç†ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
4. Streamlitã‚¢ãƒ—ãƒªã«çµ±åˆ

**ã‚¹ãƒ†ãƒƒãƒ—5: Google Sheetsé€£æºå®Ÿè£…ï¼ˆ1æ™‚é–“ï¼‰**
1. gspreadã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®èªè¨¼è¨­å®š
2. æŒ‡å®šã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ»ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆã¸ã®æ¥ç¶š
3. ãƒ‡ãƒ¼ã‚¿è¿½è¨˜æ©Ÿèƒ½ã®å®Ÿè£…
4. Streamlitã‚¢ãƒ—ãƒªã«çµ±åˆ

**ã‚¹ãƒ†ãƒƒãƒ—6: çµ±åˆãƒ†ã‚¹ãƒˆã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆ1æ™‚é–“ï¼‰**
1. å…¨æ©Ÿèƒ½ã®çµ±åˆãƒ†ã‚¹ãƒˆ
2. åŸºæœ¬çš„ãªã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®å¯¾å¿œ
3. UIã®èª¿æ•´ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã®æ”¹å–„

**ã‚¹ãƒ†ãƒƒãƒ—7: ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™ï¼ˆ30åˆ†ï¼‰**
1. Streamlit Community Cloudã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
3. å‹•ä½œç¢ºèª

**é–‹å§‹ã™ã¹ãæœ€åˆã®ã‚³ãƒ¼ãƒ‰ä¾‹ï¼š**

**requirements.txt:**
```
streamlit==1.28.0
openai==1.3.0
gspread==5.12.0
google-auth==2.23.0
python-dotenv==1.0.0
```

**app.pyï¼ˆã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ç‰ˆï¼‰:**
```python
import streamlit as st
import os
import gspread
import openai
from google.auth import default
from google.oauth2.service_account import Credentials
from datetime import datetime
import tempfile
import json
from dotenv import load_dotenv

# ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿
load_dotenv()

# ãƒšãƒ¼ã‚¸è¨­å®š
st.set_page_config(
    page_title="ãƒ†ãƒ¬ã‚¢ãƒæ–‡å­—èµ·ã“ã—ã‚·ã‚¹ãƒ†ãƒ ",
    page_icon="ğŸ“",
    layout="wide",
    initial_sidebar_state="collapsed"
)

# ã‚«ã‚¹ã‚¿ãƒ CSS
st.markdown("""
<style>
    .main-header {
        text-align: center;
        color: #1f77b4;
        margin-bottom: 2rem;
    }
    .upload-section {
        background-color: #f0f2f6;
        padding: 2rem;
        border-radius: 10px;
        margin: 1rem 0;
    }
    .result-section {
        background-color: #e8f4fd;
        padding: 2rem;
        border-radius: 10px;
        margin: 1rem 0;
    }
    .success-box {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 1rem;
        border-radius: 5px;
        margin: 1rem 0;
    }
    .error-box {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
        padding: 1rem;
        border-radius: 5px;
        margin: 1rem 0;
    }
</style>
""", unsafe_allow_html=True)

def init_openai_client():
    """OpenAI ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–"""
    api_key = os.getenv("OPENAI_API_KEY")
    if not api_key:
        st.error("âŒ OpenAI APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚.envãƒ•ã‚¡ã‚¤ãƒ«ã«OPENAI_API_KEYã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚")
        st.stop()
    
    openai.api_key = api_key
    return openai

def init_google_sheets():
    """Google Sheets ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–"""
    try:
        # Streamlit Cloudã§ã®èªè¨¼ï¼ˆst.secretsä½¿ç”¨ï¼‰
        if "gcp_service_account" in st.secrets:
            credentials_info = st.secrets["gcp_service_account"]
            credentials = Credentials.from_service_account_info(
                credentials_info,
                scopes=[
                    "https://www.googleapis.com/auth/spreadsheets",
                    "https://www.googleapis.com/auth/drive"
                ]
            )
        # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã®èªè¨¼ï¼ˆcredentials.jsonãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨ï¼‰
        elif os.path.exists("credentials.json"):
            credentials = Credentials.from_service_account_file(
                "credentials.json",
                scopes=[
                    "https://www.googleapis.com/auth/spreadsheets",
                    "https://www.googleapis.com/auth/drive"
                ]
            )
        else:
            st.error("âŒ Google Sheetsèªè¨¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚credentials.jsonãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯st.secretsã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚")
            st.stop()
        
        gc = gspread.authorize(credentials)
        return gc
    
    except Exception as e:
        st.error(f"âŒ Google Sheetsèªè¨¼ã‚¨ãƒ©ãƒ¼: {str(e)}")
        st.stop()

def transcribe_audio(audio_file):
    """éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–‡å­—èµ·ã“ã—"""
    try:
        # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜
        with tempfile.NamedTemporaryFile(delete=False, suffix=".mp3") as tmp_file:
            tmp_file.write(audio_file.getvalue())
            tmp_file_path = tmp_file.name
        
        # Whisper APIã§æ–‡å­—èµ·ã“ã—
        with open(tmp_file_path, "rb") as audio:
            response = openai.Audio.transcribe(
                model="whisper-1",
                file=audio,
                language="ja"
            )
        
        # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
        os.unlink(tmp_file_path)
        
        return response.text
    
    except Exception as e:
        if 'tmp_file_path' in locals():
            try:
                os.unlink(tmp_file_path)
            except:
                pass
        raise e

def write_to_sheets(gc, transcript_text, filename):
    """Google Sheetsã«çµæœã‚’æ›¸ãè¾¼ã¿"""
    try:
        # ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã
        spreadsheet = gc.open("ãƒ†ãƒ¬ã‚¢ãƒãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆ")
        worksheet = spreadsheet.worksheet("Difyãƒ†ã‚¹ãƒˆ")
        
        # æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®æœ€å¾Œã®è¡Œã‚’å–å¾—
        all_values = worksheet.get_all_values()
        next_row = len(all_values) + 1
        
        # ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼ˆAåˆ—ï¼šæ–‡å­—èµ·ã“ã—çµæœã€Båˆ—ï¼šãƒ•ã‚¡ã‚¤ãƒ«åã€Cåˆ—ï¼šå‡¦ç†æ—¥æ™‚ï¼‰
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        worksheet.update(f'A{next_row}:C{next_row}', [[transcript_text, filename, timestamp]])
        
        return next_row
    
    except gspread.exceptions.SpreadsheetNotFound:
        st.error("âŒ ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ 'ãƒ†ãƒ¬ã‚¢ãƒãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆ' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆåã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
        return None
    except gspread.exceptions.WorksheetNotFound:
        st.error("âŒ ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ 'Difyãƒ†ã‚¹ãƒˆ' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚·ãƒ¼ãƒˆåã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
        return None
    except Exception as e:
        st.error(f"âŒ Google Sheetsæ›¸ãè¾¼ã¿ã‚¨ãƒ©ãƒ¼: {str(e)}")
        return None

def main():
    # ãƒ˜ãƒƒãƒ€ãƒ¼
    st.markdown('<h1 class="main-header">ğŸ“ ãƒ†ãƒ¬ã‚¢ãƒæ–‡å­—èµ·ã“ã—ã‚·ã‚¹ãƒ†ãƒ </h1>', unsafe_allow_html=True)
    st.markdown("---")
    
    # ã‚·ã‚¹ãƒ†ãƒ èª¬æ˜
    with st.expander("ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦", expanded=False):
        st.markdown("""
        **ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã§ã§ãã‚‹ã“ã¨ï¼š**
        - mp3å½¢å¼ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ã§æ–‡å­—èµ·ã“ã—
        - çµæœã‚’Google Sheetsã€Œãƒ†ãƒ¬ã‚¢ãƒãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆã€ã®ã€ŒDifyãƒ†ã‚¹ãƒˆã€ã‚·ãƒ¼ãƒˆã«è‡ªå‹•ä¿å­˜
        - ãƒ†ãƒ¬ã‚¢ãƒã®å“è³ªãƒã‚§ãƒƒã‚¯æ¥­å‹™ã‚’åŠ¹ç‡åŒ–
        
        **åˆ©ç”¨æ–¹æ³•ï¼š**
        1. mp3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆæœ€å¤§25MBï¼‰
        2. ã€Œæ–‡å­—èµ·ã“ã—é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
        3. å‡¦ç†å®Œäº†ã¾ã§å¾…æ©Ÿï¼ˆé€šå¸¸1-3åˆ†ç¨‹åº¦ï¼‰
        4. çµæœãŒGoogle Sheetsã«è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™
        """)
    
    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³
    st.markdown('<div class="upload-section">', unsafe_allow_html=True)
    st.subheader("ğŸµ éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰")
    
    uploaded_file = st.file_uploader(
        "mp3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„",
        type=['mp3'],
        help="æœ€å¤§25MBã¾ã§ã®mp3ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™",
        label_visibility="collapsed"
    )
    
    # ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º
    if uploaded_file is not None:
        file_size_mb = uploaded_file.size / (1024 * 1024)
        
        col1, col2, col3 = st.columns(3)
        with col1:
            st.metric("ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«å", uploaded_file.name)
        with col2:
            st.metric("ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º", f"{file_size_mb:.2f} MB")
        with col3:
            st.metric("ğŸ“ å½¢å¼", "MP3")
        
        # ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
        if file_size_mb > 25:
            st.markdown('<div class="error-box">âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒ25MBã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>', unsafe_allow_html=True)
            st.stop()
        else:
            st.markdown('<div class="success-box">âœ… ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸ</div>', unsafe_allow_html=True)
    
    st.markdown('</div>', unsafe_allow_html=True)
    
    # å‡¦ç†å®Ÿè¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³
    if uploaded_file is not None:
        st.markdown("---")
        
        col1, col2, col3 = st.columns([1, 2, 1])
        with col2:
            if st.button("ğŸš€ æ–‡å­—èµ·ã“ã—é–‹å§‹", type="primary", use_container_width=True):
                # åˆæœŸåŒ–
                openai_client = init_openai_client()
                gc = init_google_sheets()
                
                # å‡¦ç†é–‹å§‹
                st.markdown('<div class="result-section">', unsafe_allow_html=True)
                st.subheader("âš™ï¸ å‡¦ç†çŠ¶æ³")
                
                # ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
                progress_bar = st.progress(0)
                status_text = st.empty()
                
                try:
                    # ã‚¹ãƒ†ãƒƒãƒ—1: æ–‡å­—èµ·ã“ã—
                    status_text.text("ğŸ¯ éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æä¸­...")
                    progress_bar.progress(25)
                    
                    transcript = transcribe_audio(uploaded_file)
                    
                    progress_bar.progress(75)
                    status_text.text("ğŸ“ Google Sheetsã«ä¿å­˜ä¸­...")
                    
                    # ã‚¹ãƒ†ãƒƒãƒ—2: Google Sheetsã«ä¿å­˜
                    row_number = write_to_sheets(gc, transcript, uploaded_file.name)
                    
                    if row_number:
                        progress_bar.progress(100)
                        status_text.text("âœ… å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼")
                        
                        # æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                        st.balloons()
                        st.markdown('<div class="success-box">ğŸ‰ æ–‡å­—èµ·ã“ã—ãŒå®Œäº†ã—ã¾ã—ãŸï¼</div>', unsafe_allow_html=True)
                        
                        # çµæœè¡¨ç¤º
                        st.subheader("ğŸ“„ æ–‡å­—èµ·ã“ã—çµæœ")
                        
                        # çµæœã®è©³ç´°æƒ…å ±
                        col1, col2 = st.columns(2)
                        with col1:
                            st.metric("ğŸ“ ä¿å­˜è¡Œ", f"{row_number}è¡Œç›®")
                        with col2:
                            st.metric("â° å‡¦ç†å®Œäº†æ™‚åˆ»", datetime.now().strftime("%H:%M:%S"))
                        
                        # æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆã®è¡¨ç¤º
                        st.text_area(
                            "æ–‡å­—èµ·ã“ã—ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ:",
                            value=transcript,
                            height=200,
                            disabled=True
                        )
                        
                        # æ¬¡ã®å‡¦ç†ã¸ã®ã‚¬ã‚¤ãƒ‰
                        st.info("ğŸ’¡ çµæœã¯Google Sheetsã€Œãƒ†ãƒ¬ã‚¢ãƒãƒã‚§ãƒƒã‚¯ã‚·ãƒ¼ãƒˆã€ã®ã€ŒDifyãƒ†ã‚¹ãƒˆã€ã‚·ãƒ¼ãƒˆã«ä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚")
                        
                        # ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
                        if st.button("ğŸ”„ æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†", use_container_width=True):
                            st.experimental_rerun()
                
                except openai.error.AuthenticationError:
                    progress_bar.progress(0)
                    st.markdown('<div class="error-box">âŒ OpenAI APIèªè¨¼ã‚¨ãƒ©ãƒ¼: APIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„</div>', unsafe_allow_html=True)
                
                except openai.error.RateLimitError:
                    progress_bar.progress(0)
                    st.markdown('<div class="error-box">âŒ APIåˆ©ç”¨åˆ¶é™ã«é”ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„</div>', unsafe_allow_html=True)
                
                except openai.error.InvalidRequestError as e:
                    progress_bar.progress(0)
                    st.markdown(f'<div class="error-box">âŒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: {str(e)}</div>', unsafe_allow_html=True)
                
                except Exception as e:
                    progress_bar.progress(0)
                    st.markdown(f'<div class="error-box">âŒ äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {str(e)}</div>', unsafe_allow_html=True)
                    st.error("ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚")
                
                st.markdown('</div>', unsafe_allow_html=True)
    
    # ãƒ•ãƒƒã‚¿ãƒ¼
    st.markdown("---")
    st.markdown(
        """
        <div style='text-align: center; color: #666; font-size: 0.8rem;'>
        ãƒ†ãƒ¬ã‚¢ãƒæ–‡å­—èµ·ã“ã—ã‚·ã‚¹ãƒ†ãƒ  MVP | Powered by OpenAI Whisper & Google Sheets
        </div>
        """, 
        unsafe_allow_html=True
    )

if __name__ == "__main__":
    main()

```

ã“ã®MVPè¦ä»¶å®šç¾©ã«æ²¿ã£ã¦é–‹ç™ºã‚’é€²ã‚ã‚‹ã“ã¨ã§ã€æœ€çŸ­æ™‚é–“ã§å‹•ä½œã™ã‚‹ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã‚’æ§‹ç¯‰ã—ã€ãã®å¾Œæ®µéšçš„ã«æ©Ÿèƒ½ã‚’æ‹¡å¼µã—ã¦ã„ãã“ã¨ãŒå¯èƒ½ã§ã™ã€‚